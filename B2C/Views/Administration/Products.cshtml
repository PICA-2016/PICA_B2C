
@{
    ViewBag.Title = "Products";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="modal fade" id='detailModal' data-url='@Url.Action("ProductDetail", new {id="-id-" })' role="dialog" data-backdrop="static"  data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            </div>
            <div id='modalInnerContainer'>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Products</h1>
    </div>
    <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div class="dataTable_wrapper">
                    <table class="table table-striped table-bordered table-hover" id="productsTable">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Price</th>
                                <th>Detail</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="odd gradeA">
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td class="center"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section css {
    @Styles.Render("~/css/dataTables")
}
@section scripts {
    @Scripts.Render("~/bundles/dataTables"),
    @Scripts.Render("~/bundles/dataTables_bootstrap"),
    @*@Scripts.Render("~/bundles/table")*@

    @*<script src="~/Scripts/DataTables/jquery.dataTables.js"></script>*@
    <script src="~/bower_components/datatables/media/js/jquery.dataTables.js"></script>

    <script type="text/javascript">
        var productsTable;
        $(document).ready(function () {
            //Table Products
            productsTable = $('#productsTable').DataTable({
                "responsive": true,
                "processing": true,
                "serverSide": true,
                @*"language": {
                    "url": "@Url.Action("DatatablesLocalizacion")"
                },*@
                "ajax": {
                    "url": "@Url.Action("FilterProducts")",
                    "error": errorTable
                },
                columns: [
                     { data: 'Code' },
                     { data: 'Name' },
                     { data: 'Description' },
                     { data: 'Price' },
                     {
                         "targets": -1,
                         "data": null,

                         "defaultContent": "<button onclick='ProductDetail(this)'><img src='../../Content/Images/ViewDetail.png'/></button>"
                     }
                ],
            });
        });

        //Detail Product
        function ProductDetail(e) {
            var dataRow = productsTable.row($(e).parents('tr')).data();
            var url = $('#detailModal').data('url');
            url = url.replace("-id-", dataRow.ProductId);
            $.get(url, function (data) {
                $('#modalInnerContainer').html(data);

                $('#detailModal').modal('show');
            });
        }

        //Complete Detail
        function CompleteDetail(menssaje) {
            $('#detailModal').modal('hide');
            productsTable.ajax.reload();
            if (menssaje != null && menssaje != '') {
                document.getElementById("resultMessage").innerHTML = menssaje;
                $("#resultMessageContainer").removeClass('hidden');
            }
        }

        //Error
        function error() {
            $('#resultMessage').text("Connection error");
            $('#resultMessageContainer').removeClass('hidden');
        }

        //Error table
        function errorTable() {
            $('#resultMessage').text("They will not be see data");
            $('#resultMessageContainer').removeClass('hidden');
        }

        //Clean validation control
        function CleanValidations() {
            $('#validationMessage').empty();
        }
    </script>
}

